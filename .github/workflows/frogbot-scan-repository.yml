name: "Frogbot Scan Repository"

on:
  workflow_dispatch:
  schedule:
    # The repository will be scanned once a day at 00:00 GMT.
    - cron: "0 0 * * *"

permissions:
  contents: write
  pull-requests: write
  security-events: write
  # Ensure id-token: write is enabled for OIDC
  id-token: write 

jobs:
  scan-repository:
    runs-on: ubuntu-latest
    name: Scan Repository (${{ matrix.branch }} branch) # Added job name for clarity
    strategy:
      matrix:
        # The repository scanning will be triggered periodically on the following branches.
        branch: ["main"]
        
    steps:
      - uses: jfrog/frogbot@v2.24.1
        # --- CORRECTED: 'with' block must come immediately after 'uses' ---
        with: 
          # [Mandatory if using OIDC authentication protocol]
          # Insert to oidc-provider-name the 'Provider Name' defined in the OIDC integration configured in the JPD
          oidc-provider-name: "srs-test"

        # --- CORRECTED: 'env' block must be indented correctly ---
        env:
          # [Mandatory]
          # JFrog platform URL
          JF_URL: ${{ secrets.JF_URL }}

          # [Conditional Authentication - OIDC is used here, so ACCESS_TOKEN is commented out]
          # JF_ACCESS_TOKEN: ${{ secrets.JF_ACCESS_TOKEN }} 
          
          # [Optional CA Certificate Path]
          # NOTE: $CI_PROJECT_PATH is a GitLab variable. Use GitHub context if this path is dynamic.
          # If the file is just in the checkout directory, a simple relative path might suffice.
          JFROG_CLI_CA_CERT_PATH: "/builds/$CI_PROJECT_PATH/xray-root-ca.pem" 
          
          # [Mandatory]
          # The GitHub token is automatically generated for the job
          JF_GIT_TOKEN: ${{ secrets.GITHUB_TOKEN }}

          # [Mandatory]
          # The name of the branch on which Frogbot will perform the scan
          JF_GIT_BASE_BRANCH: ${{ matrix.branch }}
